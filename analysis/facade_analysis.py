import logging
from typing import Callable

import numpy as np

from analysis.analysis_config import Config
from analysis.strategy.camera_calibration_strategy import CameraCalibrationStrategy
from analysis.strategy.main_strategy import MainAnalysisStrategy


class FacadeAnalysis:
    """Класс, через который осуществляется взаимодействие обработки с сайтом
    Данный класс создан 24.11.25. Без намеков
    ......................^@@(''.....''@J'..........................
    .................'@+.'................''''b@^...................
    .............'`B'............................*r'................
    ............'#'................................a!...............
    ...........'#...........'''.,1111`''''...........B..............
    ..........0'...........`^Z@Wa***@)'`....-@.......`:.............
    .........@.............`w``ioB$o-.'IW*''IB`'......':............
    .......'w'.............I@d@.-`.''(#$B_t'^`$>.......l............
    ......'@............'^@@''...........`......'.......#...........
    .....`@.............@@''...................<@@@a'....B..........
    ....'$.............@@'.....................''...@@@'..@.........
    ....z`............'``.....................'`.....''B)`'I........
    ..'.'......................................'..........$$'.......
    .$@@@@@@@@@$!'`......................h.....'..........'^........
    .@@^'j@@@@@@@@@@@@@@@X...`'.`.......''.....`...........'@.......
    .$@............''`'~M@@@$W@@@@@@@@@@@@ppw''".....'''....@'......
    .`'..................'@$.............{@@@@@@@@CC@@@@@@@@@.......
    ......................@`..'..........@b....$k@@@@@..-o@@@.......
    .v...................Y@)>@@@@@@'....@@......@@@@@B`...B@@0<'....
    .@...................@@B'/@@@@....'Y`@'.....'].`.`'''..@...<I...
    .@...................@@^^.YW++m@!`...B'......'I"......'@'....f..
    .$....................''"'rW@@@@@@@@$`..........d@@@@@$`.....`v.
    .@'..............................................`'............"
    .>................................................''..........'$
    .>.................................................>`$1@.......>
    ...................................................'W'...I.....(
    .'..................................................."..').....#
    .''...................................."X..............'@.....@.
    ..@`..................................,'..............._'....d..
    o.@1"................................'#...............'@'.._h:..
    .rM`..................................p'..............'^.''$"...
    .k^@'...............................:'..`..]0QCW$"..|B'.'Y#h.'..
    ..(jit'..........................'.-`...........`^)@`....'.'-'..
    ..|M:W@.........................'Y`..........'fa'$:'^..`dt$$....
    ....Mt`........................`1...'k'...'^t*n^'.(.....@'.'....
    ....',@-^.......................'...''^`w@'.....]^`....@Cp''....
    .'@^..>!C''X...................'@.....................'BB@'.....
    '.....:'`@b'.....................;"...................w0'''.....
    ..........c'+......................................'@mm`'.......
    ..........@'X'|....................................;{#`B'.......
    ...........'.$@-..................................'@@@@.........
    ............!|@~1x..................''...........'.oB..W........
    ...............iW-B:'W...............$'.........'f@[@...........
    ...................@*(..;"...........'`x......';of!M.'..........
    ....................>@{a@`^C'...........'^WX><<v$w*`J...........
    .......................'<@a@`:YM'`.'I.....p'@.$M.'.'............
    ..........................`:B`:*B@n`@`.$W@J-$hBZ'...............
    .............................'.'.':$w@o`.$'!....................
    """
    def __init__(self):
        self._camera_calibration = CameraCalibrationStrategy()
        self._is_calibrated = Config.load_calibration()

        self._main_strategy = MainAnalysisStrategy()

    def analyze_frame(self, frame:np.ndarray)->np.ndarray:
        if self._is_calibrated:
            return self._main_strategy(frame)
        else:
            frame = self._camera_calibration(frame)
            self._is_calibrated = Config.load_calibration()
            return frame


class EmptyFacadeAnalysis:
    def __init__(self):
        logging.warn('Фасад создан')

    def analyze_frame(self, frame:np.ndarray)->np.ndarray:
        return frame